#:kivy 1.0

### device management 
#:import ListHelioStatsIp device_mange.listHelioStatsIp.ListHelioStatsIp
#:import ListCameraIp device_mange.listCameraIp.ListCameraIp
#:import Description device_mange.description.Description
#:import UploadConnectionPage device_mange.uploadConnectionPage.UploadConnectionPage

### Camera control
#:import SetAutoScreen camera_control.auto_screen_widget.SetAutoScreen
#:import ManualScreen camera_control.manual_screen_widget.ManualScreen


MainFrameWidget: 

<MainFrameWidget>:
    LabHeaderWidget:

<ManualScreen>:
    BoxLayout:
        orientation: 'vertical'
        padding: 10
        spacing: 10

        # Camera status label
        BoxLayout:
            orientation: 'vertical'
            size_hint_y: .1
            Label:
                id: camera_status
                text: 'Manual menu || Camera status: Off'
                bold: True

        # Camera control buttons
        GridLayout:
            cols: 3
            size_hint_y: .1
            spacing: 10
            padding: 10

            Button:
                text: 'Stop Camera'
                background_color: (.4, .4, .4, 1)
                on_press: root.call_close_camera()

            Button:
                text: 'Start Camera'
                background_color: (.4, .4, .4, 1)
                on_press: root.call_open_camera()

            Button:
                text: "Cancel Crop"
                background_color: (.4, .4, .4, 1)
                on_press: root.reset_selection()

        # Area for camera image and cropping interaction
        BoxLayout:
            orientation: 'vertical'
            size_hint_y: .6
            canvas:
                Color:
                    rgba: 1, 1, 1, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
            Image:
                id: manual_cam_image
                source: 'images/sample_image.png'  # Initial image
                allow_stretch: True
                keep_ratio: True
                on_touch_down: None
                on_touch_move: None
                on_touch_up: None

        # Information and controls
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: .3
            spacing: 10

            # Left side: Information labels
            GridLayout:
                cols: 1
                spacing: 10

                GridLayout:
                    cols: 2
                    size_hint_y: None
                    height: '40dp'

                    Label:
                        text: 'Center Target'
                        bold: True
                        font_size: 20

                    Label:
                        id: manual_center_target_position
                        text: 'Null'
                        bold: True
                        font_size: 20

                GridLayout:
                    cols: 2
                    size_hint_y: None
                    height: '40dp'

                    Label:
                        text: 'Center Frame'
                        bold: True
                        font_size: 20

                    Label:
                        id: manual_center_frame_position
                        text: 'Null'
                        bold: True
                        font_size: 20

                GridLayout:
                    cols: 2
                    size_hint_y: None
                    height: '40dp'

                    Label:
                        text: 'Error Center'
                        bold: True
                        font_size: 20

                    Label:
                        id: manual_error_center
                        text: 'Null'
                        bold: True
                        font_size: 20

                GridLayout:
                    cols: 2
                    size_hint_y: None
                    height: '40dp'

                    Label:
                        text: 'Bounding Frame'
                        bold: True
                        font_size: 20

                    Label:
                        id: manual_bounding_frame_position
                        text: 'Null'
                        bold: True
                        font_size: 20

                GridLayout:
                    cols: 2
                    size_hint_y: None
                    height: '40dp'

                    Label:
                        text: 'Using Crop'
                        bold: True
                        font_size: 20

                    Label:
                        id: using_crop_value_status
                        text: "Using Crop: Off"
                        bold: True
                        font_size: 20

            # Right side: Control buttons
            GridLayout:
                cols: 3
                spacing: 10

                Button:
                    text: 'Reset Crop'
                    on_press: root.reset_crop_value()
                    background_color: (.4, .4, .4, 1)

                Button:
                    text: "Save Crop"
                    on_press: root.save_crop_value_image()
                    background_color: (.4, .4, .4, 1)

                Button:
                    text: 'Crop Mode'
                    on_press: root.active_crop_value()
                    background_color: (.4, .4, .4, 1)

<SetAutoScreen>:
    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            orientation: 'vertical'
            size_hint_y: .1
            Label:
                id: camera_status_auto_mode
                text: 'Auto menu || camera status off'
                bold: True
        Image:
            id: auto_cam_image
            size: self.size
            allow_stretch: True
            keep_ratio: True
            # pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            # Ensure the Image widget doesn't consume touch events
            on_touch_down: None
            on_touch_move: None
            on_touch_up: None
            
        BoxLayout:
            orientation: 'vertical'
            size_hint_y: .45
            GridLayout:
                rows: 5
                Label:
                    id: auto_lable_mode
                    text: "Auto mode stopped"
                    bold: True
                    font_size: 35
                    canvas.before:
                        Color: 
                            rgba: (.2,.2,.2,1)
                        Rectangle:
                            pos:self.pos
                            size:self.size
                GridLayout:
                    cols: 2
                    BoxLayout:
                        Label:
                            text: 'Center target positon'
                            bold: True
                            font_size: 25
                        Label:
                            id: auto_center_target_position
                            text:'Null'
                            bold: True
                            font_size: 25

                    BoxLayout:
                        Label:
                            text: 'Center frame positon'
                            bold: True
                            font_size: 25
                        Label:
                            id: auto_center_frame_position
                            text:'Null'
                            bold: True
                            font_size: 25
                GridLayout:
                    cols: 2
                    Label:
                        text: 'Error center'
                        bold: True
                        font_size: 25
                    Label:
                        id: auto_error_center
                        text: 'Null'
                        bold: True
                        font_size: 25

                GridLayout:
                    cols: 1
                    BoxLayout:
                        Label:
                            text: 'Bounding box frame'
                            bold: True
                            font_size: 25
                        Label:
                            id: auto_bounding_frame_position
                            text:'Null'
                            bold: True
                            font_size: 25

                GridLayout:
                    cols: 3
                    Button:
                        text: 'Auto off'
                        on_press: root.call_close_camera()
                    Button:
                        text: 'Auto on'
                        on_press: root.call_open_camera()
                    Button:
                        text: "Cancel crop"
                        background_color: (.4, .4, .4, 1)
                        on_press: root.cancel_crop()

<ListHelioStatsIp>:
    viewclass: 'Label' 
    orientation: "vertical"
    # spacing: 40
    # padding:10, 10
    # space_x: self.size[0]/3
    RecycleBoxLayout: 
        color:(0, 0.7, 0.4, 0.8) 
        default_size: None, dp(56) 
        default_size_hint: 1, None 
        size_hint_y: None
        height: self.minimum_height 
        orientation: 'vertical'

<ListCameraIp>:
    viewclass: 'Label' 
    orientation: "vertical"
    # spacing: 40
    # padding:10, 10
    # space_x: self.size[0]/3
    RecycleBoxLayout: 
        color:(0, 0.7, 0.4, 0.8) 
        default_size: None, dp(56) 
        default_size_hint: 1, None 
        size_hint_y: None
        height: self.minimum_height 
        orientation: 'vertical'


<Description>:
    BoxLayout:
        orientation: 'vertical'
        GridLayout:
            cols: 2
            BoxLayout:
                orientation: 'vertical'
                Label:
                    text: "Helio stats ip"
                ScrollView:
                    ListHelioStatsIp:
            BoxLayout:
                orientation: 'vertical'
                Label:
                    text: 'Camera ip'
                ScrollView:
                    ListCameraIp:
        

<UploadConnectionPage>:
    BoxLayout:
        orientation: 'vertical'
        Label:
            text: 'Syntax for adding Helio stats and camera ip'
        Image:
            source: './exmaple_syntax.png'

        ## select connection file ##
    BoxLayout:
        orientation: 'vertical'
        padding: 10
        spacing: 10
        Label:
            text: 'Upload and Display JSON File'
            font_size: '20sp'
            size_hint_y: None
            height: '40dp'
        Button:
            text: 'Select JSON File'
            size_hint_y: None
            height: '50dp'
            on_release: root.open_file_dialog()
        ScrollView:
            GridLayout:
                id: json_display
                cols: 1
                size_hint_y: None
                height: self.minimum_height
                padding: 10
                spacing: 10

<LabHeaderWidget>:
    orientation: 'vertical'
    BoxLayout:
        size_hint_y: None
        height: 100
        canvas.before:
            Color: 
                rgba: (.3,.3,.3,1)
            Rectangle: 
                pos:self.pos
                size:self.size
        Button:
            text: "Manual"
            on_press: root.ids.screen_manager.current = 'manual'
        Button:
            text: "Auto mode"
            on_press: root.ids.screen_manager.current = 'auto'
        Button:
            text: "Description"
            on_press: root.ids.screen_manager.current = 'description'
        Button:
            text: "Connection upload"
            on_press: root.ids.screen_manager.current = 'upload_connection'

    ScreenManager:
        id: screen_manager
        ManualScreen:
            name: 'manual'
        SetAutoScreen:
            name: 'auto'
        Description:
            name: 'description'
        UploadConnectionPage:
            name: 'upload_connection'

